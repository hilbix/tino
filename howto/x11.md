# X11 howto

## `su` => `xsu`

Problem:

You are logged on with X11 to one account and you need to run some X11 app on another account.

> Same machine, other account.

I tried, but none of the solutions out there worked for me.  Here is how, as simple as it can get.

> Do not leave away any quote!

```
AUTH="$(xauth list)" su --whitelist-environment=AUTH - $OTHERACCOUNT
exec bash -l
while read -ra line; do export DISPLAY=":${line[0]##*:}"; xauth add "${line[@]}" && xhost >/dev/null || continue; unset AUTH; break; done <<< "$AUTH"
```

> `xauth` and `xhost` should always be available.  But if `xhost` is not what you want to use for tests,
> try some other command which immediately and always returns success if `$DISPLAY` works:
>
> `xdpyinfo`, `xmodmap`, `xdotool getmouselocation`
>
> Not suitable are commands like `xclip`, which may fail too many ways.

How to automate this recipe?

```
xsu()
{
  AUTH="$(xauth list)" su --whitelist-environment=AUTH --shell=/bin/bash --pty -- - "$1" -c '
    while read -ra line;
    do
      export DISPLAY=":${line[0]##*:}";
      xauth add "${line[@]}" && xhost >/dev/null || continue;
      unset AUTH;
      break;
    done <<< "$AUTH";
    [ 0 = $# ] && exec "$SHELL" -l;
    exec "$SHELL" -c "exec \"\$@\"" "$SHEll" "$@";
  ' - "${@:2}"
}
```

Then just run `xsu user` or `xsu user cmd args..`.

As simple as it can get.
